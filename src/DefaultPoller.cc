#include <stdlib.h>

#include "Poller.h"
#include "EPollPoller.h"
// å·¥å‚ç±»ï¼ˆå°è£…åˆ›å»ºé€»è¾‘ï¼‰
//å·¥å‚æ¨¡å¼å°è£…äº†å¯¹è±¡çš„åˆ›å»ºé€»è¾‘ï¼Œè¿”å›ä¸€ä¸ªåŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨ï¼ˆä¾èµ–å¤šæ€ï¼‰ã€‚
//å·¥å‚æ–¹æ³•è¿”å›çš„å¯¹è±¡é€šè¿‡å¤šæ€æœºåˆ¶ï¼ŒåŠ¨æ€ç»‘å®šåˆ°å…·ä½“çš„å­ç±»å®ç°ã€‚
/*
å¤šæ€æ€§çš„æ ¸å¿ƒæ˜¯é€šè¿‡ åŸºç±»æŒ‡é’ˆæˆ–å¼•ç”¨ è°ƒç”¨æ´¾ç”Ÿç±»çš„é‡å†™æ–¹æ³•ã€‚
è°ƒç”¨ poller->updateChannel() æ—¶ï¼Œç”±äºåŸºç±»å®šä¹‰ä¸º virtual å‡½æ•°ï¼Œè°ƒç”¨ä¼šè¢«åŠ¨æ€ç»‘å®šåˆ° EPollPoller::updateChannel() çš„å®ç°ã€‚
ğŸ“Œ åœ¨åº•å±‚ï¼ŒåŠ¨æ€ç»‘å®šæ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ
æ¯ä¸ªå¸¦æœ‰è™šå‡½æ•°çš„ç±»éƒ½æœ‰ä¸€ä¸ª è™šå‡½æ•°è¡¨ï¼ˆvtableï¼‰ã€‚
ç¼–è¯‘å™¨åœ¨ç”Ÿæˆå¯¹è±¡æ—¶ï¼Œç»™å¯¹è±¡ç»‘å®šä¸€ä¸ªæŒ‡å‘ vtable çš„æŒ‡é’ˆï¼ˆvptrï¼‰ã€‚
å½“é€šè¿‡åŸºç±»æŒ‡é’ˆè°ƒç”¨è™šå‡½æ•°æ—¶ï¼Œç¨‹åºä¼šé€šè¿‡ vptr æŸ¥æ‰¾ vtable ä¸­å¯¹åº”çš„å‡½æ•°åœ°å€ï¼Œå¹¶åœ¨è¿è¡Œæ—¶è°ƒç”¨è¯¥å‡½æ•°ã€‚
åœ°å€		å†…å®¹					è¯´æ˜
0x1000	vptr -> 0x2000		æŒ‡å‘ Derived çš„ vtable
0x1008	æˆå‘˜å˜é‡1				å¯¹è±¡çš„å®é™…æˆå‘˜å˜é‡
0x1010	æˆå‘˜å˜é‡2				å¯¹è±¡çš„å®é™…æˆå‘˜å˜é‡
0x2000	Derived::func1()	vtable[0]ï¼Œè¦†ç›–è‡ª Base
0x2008	Derived::func2()	vtable[1]ï¼Œè¦†ç›–è‡ª Base
*/

Poller *Poller::newDefaultPoller(EventLoop *loop){
	if(::getenv("MUDUO_USE_POLL")){	//æ ¹æ®ç¯å¢ƒå˜é‡é€‰æ‹©å¯¹åº”çš„pollç±»å‹
		return nullptr;	//æš‚ä¸æ”¯æŒpollç±»å‹ç›‘å¬
	}
	else{
		return new EPollPoller(loop);	//ç”Ÿæˆepollå®ä¾‹
	}
}